# Code Review of [ollama_bash_lib.sh](../ollama_bash_lib.sh)

A [demo](../README.md#demos) of [Ollama Bash Lib](https://github.com/attogram/ollama-bash-lib) v0.40.11

## Review

```bash
task="Act as an Expert Software Engineer.
Do a critical Code Review of this script.
Output your review in Markdown format."
file="../ollama_bash_lib.sh"
ollama_generate_stream "granite3.3:8b" "$task\n\n$(cat "$file")"
```
This is a Bash script that provides a library of functions for interacting with Ollama, an application for running large language models. The library includes functions for various tasks such as getting version information, estimating the number of tokens in a string, and retrieving information about Ollama itself. The script also includes functions for getting Ollama application version information in different formats (text, JSON, CLI), managing Ollama's configuration, loading models, handling errors, and more. The library is designed to be used with Ollama, a tool for running large language models, and provides a convenient way to interact with it from the command line.
## Review Debug

```bash
OLLAMA_LIB_DEBUG=1
task="Act as an Expert Software Engineer.
Do a critical Code Review of this script.
Output your review in Markdown format."
file="../ollama_bash_lib.sh"
ollama_generate_stream "granite3.3:8b" "$task\n\n$(cat "$file")"
```
[DEBUG] ollama_generate_stream: [granite3.3:8b] [Act as an Expert Software Engineer.
Do a c]
[DEBUG] ollama_generate_json: [granite3.3:8b] [Act as an Expert Software Engineer.
Do a c]
[DEBUG] ollama_generate_json: OLLAMA_LIB_STREAM: 1
[DEBUG] json_clean: 14 bytes [granite3.3:8b]
[DEBUG] json_clean: 23486 bytes [Act as an Expert Software Engineer.
Do a c]
[DEBUG] ollama_api_post: [/api/generate] [{"model":"granite3.3:8b","prompt":"Act as ]
[DEBUG] ollama_api_post: return 0
[DEBUG] ollama_generate_json: return: 0
[DEBUG] json_sanitize: 100 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 100 bytes [[{"model":"granite3.3:8b","created_at":"202]]
This[DEBUG] json_sanitize: 99 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 99 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 is[DEBUG] json_sanitize: 98 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 98 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 a[DEBUG] json_sanitize: 101 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 101 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 Bash[DEBUG] json_sanitize: 104 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 104 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 library[DEBUG] json_sanitize: 100 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 100 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 for[DEBUG] json_sanitize: 108 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 108 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 interacting[DEBUG] json_sanitize: 101 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 101 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 with[DEBUG] json_sanitize: 98 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 98 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 O[DEBUG] json_sanitize: 98 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 98 bytes [[{"model":"granite3.3:8b","created_at":"202]]
ll[DEBUG] json_sanitize: 99 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 99 bytes [[{"model":"granite3.3:8b","created_at":"202]]
ama[DEBUG] json_sanitize: 96 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 96 bytes [[{"model":"granite3.3:8b","created_at":"202]]
,[DEBUG] json_sanitize: 97 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 97 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 a[DEBUG] json_sanitize: 105 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 105 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 language[DEBUG] json_sanitize: 102 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 102 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 model[DEBUG] json_sanitize: 103 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 103 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 server[DEBUG] json_sanitize: 97 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 97 bytes [[{"model":"granite3.3:8b","created_at":"202]]
.[DEBUG] json_sanitize: 99 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 99 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 It[DEBUG] json_sanitize: 105 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 105 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 includes[DEBUG] json_sanitize: 106 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 106 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 functions[DEBUG] json_sanitize: 100 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 100 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 for[DEBUG] json_sanitize: 104 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 104 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 various[DEBUG] json_sanitize: 102 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 102 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 tasks[DEBUG] json_sanitize: 101 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 101 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 such[DEBUG] json_sanitize: 99 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 99 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 as[DEBUG] json_sanitize: 104 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 104 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 getting[DEBUG] json_sanitize: 100 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 100 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 the[DEBUG] json_sanitize: 104 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 104 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 version[DEBUG] json_sanitize: 99 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 99 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 of[DEBUG] json_sanitize: 98 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 98 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 O[DEBUG] json_sanitize: 98 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 98 bytes [[{"model":"granite3.3:8b","created_at":"202]]
ll[DEBUG] json_sanitize: 98 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 98 bytes [[{"model":"granite3.3:8b","created_at":"202]]
ama[DEBUG] json_sanitize: 97 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 97 bytes [[{"model":"granite3.3:8b","created_at":"202]]
,[DEBUG] json_sanitize: 102 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 102 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 estim[DEBUG] json_sanitize: 101 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 101 bytes [[{"model":"granite3.3:8b","created_at":"202]]
ating[DEBUG] json_sanitize: 102 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 102 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 token[DEBUG] json_sanitize: 103 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 103 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 counts[DEBUG] json_sanitize: 99 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 99 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 in[DEBUG] json_sanitize: 104 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 104 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 strings[DEBUG] json_sanitize: 97 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 97 bytes [[{"model":"granite3.3:8b","created_at":"202]]
,[DEBUG] json_sanitize: 99 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 99 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 and[DEBUG] json_sanitize: 105 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 105 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 managing[DEBUG] json_sanitize: 98 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 98 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 O[DEBUG] json_sanitize: 98 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 98 bytes [[{"model":"granite3.3:8b","created_at":"202]]
ll[DEBUG] json_sanitize: 99 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 99 bytes [[{"model":"granite3.3:8b","created_at":"202]]
ama[DEBUG] json_sanitize: 97 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 97 bytes [[{"model":"granite3.3:8b","created_at":"202]]
-[DEBUG] json_sanitize: 103 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 103 bytes [[{"model":"granite3.3:8b","created_at":"202]]
related[DEBUG] json_sanitize: 108 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 108 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 environment[DEBUG] json_sanitize: 106 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 106 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 variables[DEBUG] json_sanitize: 97 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 97 bytes [[{"model":"granite3.3:8b","created_at":"202]]
.[DEBUG] json_sanitize: 100 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 100 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 The[DEBUG] json_sanitize: 104 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 104 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 library[DEBUG] json_sanitize: 101 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 101 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 also[DEBUG] json_sanitize: 105 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 105 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 provides[DEBUG] json_sanitize: 106 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 106 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 functions[DEBUG] json_sanitize: 100 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 100 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 for[DEBUG] json_sanitize: 106 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 106 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 debugging[DEBUG] json_sanitize: 100 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 100 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 and[DEBUG] json_sanitize: 102 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 102 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 about[DEBUG] json_sanitize: 108 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 108 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 information[DEBUG] json_sanitize: 97 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 97 bytes [[{"model":"granite3.3:8b","created_at":"202]]
.[DEBUG] json_sanitize: 100 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 100 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 The[DEBUG] json_sanitize: 104 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 104 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 version[DEBUG] json_sanitize: 99 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 99 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 of[DEBUG] json_sanitize: 100 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 100 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 the[DEBUG] json_sanitize: 104 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 104 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 library[DEBUG] json_sanitize: 103 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 103 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 itself[DEBUG] json_sanitize: 99 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 99 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 is[DEBUG] json_sanitize: 104 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 104 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 defined[DEBUG] json_sanitize: 99 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 99 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 by[DEBUG] json_sanitize: 100 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 100 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 the[DEBUG] json_sanitize: 98 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 98 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 O[DEBUG] json_sanitize: 98 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 98 bytes [[{"model":"granite3.3:8b","created_at":"202]]
LL[DEBUG] json_sanitize: 99 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 99 bytes [[{"model":"granite3.3:8b","created_at":"202]]
AMA[DEBUG] json_sanitize: 97 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 97 bytes [[{"model":"granite3.3:8b","created_at":"202]]
_[DEBUG] json_sanitize: 99 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 99 bytes [[{"model":"granite3.3:8b","created_at":"202]]
LIB[DEBUG] json_sanitize: 97 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 97 bytes [[{"model":"granite3.3:8b","created_at":"202]]
_[DEBUG] json_sanitize: 103 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 103 bytes [[{"model":"granite3.3:8b","created_at":"202]]
VERSION[DEBUG] json_sanitize: 105 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 105 bytes [[{"model":"granite3.3:8b","created_at":"202]]
 variable[DEBUG] json_sanitize: 97 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 97 bytes [[{"model":"granite3.3:8b","created_at":"202]]
.[DEBUG] json_sanitize: 35051 bytes [{"model":"granite3.3:8b","created_at":"202]
[DEBUG] json_sanitize: sanitized: 35051 bytes [[{"model":"granite3.3:8b","created_at":"202]]
[DEBUG] ollama_generate_stream: return: 0
